---
# applyTo: 'modules/**'
name: 'Service_Initialization'
description: 'Правила инициализации сервисов: критичные — через AppServices, редкие — локально.'
---

- При изменении проекта обновить этот файл.

## Инициализация сервисов

### Правила

| Тип сервиса | Где создавать | Примеры |
|-------------|---------------|---------|
| **Критичные** (используются везде, единый жизненный цикл) | `modules.core.AppServices` | -/- |
| **Редкие/тяжёлые** (используются редко, ресурсоёмкие) | Локально в месте использования | -/- |

### Примеры

**Правильно** — локальное создание редкого сервиса:
```python
def process_heavy_task() -> list:
    # Импорт внутри функции избегает инициализации при импорте модуля
    from modules.services import ExpensiveService

    service = ExpensiveService()
    output = service.run()
    return output
```

**Неправильно** — глобальная инициализация при импорте:
```python
expensive_service = ExpensiveService()  # Плохо!
```

### Добавление сервиса в AppServices

1. Добавить поле `_service: Optional[ServiceType] = None` в `__init__`
2. Создать ленивое `@property` с инициализацией при первом обращении
3. Добавить закрытие в `shutdown()` если сервис требует очистки ресурсов

### Требования

- **Конфигурация:** использовать `get_config()`, не читать файлы напрямую
- **Логирование:** использовать `get_logger(__name__)`
- **Shutdown:** сервисы с сетевыми/файловыми ресурсами должны иметь метод закрытия
